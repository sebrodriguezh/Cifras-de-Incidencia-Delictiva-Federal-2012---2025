<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Incidencia Delictiva - SESNSP M√©xico</title>
    
    <!-- Custom CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/snapshots.css">
</head>
<body>
    <!-- Header Section -->
    <header class="main-header">
        <div class="header-content">
            <h1>An√°lisis de las cifras de incidencia delictiva federal </h1>
            <p class="subtitle">Datos del Secretariado Ejecutivo del Sistema Nacional de Seguridad P√∫blica</p>
            <p class="update-date">√öltima actualizaci√≥n: Agosto 2025</p>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="main-container">
        <!-- Overview section -->
        <section class="content-section">
            <h2>Estructura de la base de datos</h2>
            <p class="section-description">Overview de la base de datos original</p>

            <!-- Data Summary Cards -->
            <div class="data-overview">
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Total de registros</h3>
                        <p class="card-number" id="total-registros-original">Cargando...</p>
                        <p class="card-description">Registros delictivos incluidos</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Per√≠odo</h3>
                        <p class="card-number" id="periodo-original">Cargando...</p>
                        <p class="card-description">Rango temporal completo</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Estados</h3>
                        <p class="card-number" id="total-estados-original">Cargando...</p>
                        <p class="card-description">Entidades federativas incluidas</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Conceptos</h3>
                        <p class="card-number" id="conceptos-unicos-original">Cargando...</p>
                        <p class="card-description">Conceptos principales</p>
                    </div>
                </div>
            </div>
            <p class="section-description">Base de datos procesada para el resto del informe</p>
            <!-- Data Summary Cards - Base Procesada -->
            <div class="data-overview">
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Total de Registros</h3>
                        <p class="card-number" id="total-registros-procesados">Cargando...</p>
                        <p class="card-description">Registros delictivos procesados</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Per√≠odo</h3>
                        <p class="card-number" id="periodo-procesado">Cargando...</p>
                        <p class="card-description">Rango temporal filtrado</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Estados</h3>
                        <p class="card-number" id="total-estados-procesados">Cargando...</p>
                        <p class="card-description">Entidades federativas incluidas</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-icon"></div>
                    <div class="card-content">
                        <h3>Conceptos</h3>
                        <p class="card-number" id="conceptos-unicos-procesados">Cargando...</p>
                        <p class="card-description">Conceptos principales</p>
                    </div>
                </div>
            </div>
            
            <!-- Database Preview Table - Solo Base Procesada -->
            <div class="database-preview">
                <h3>Vista previa de la base procesada</h3>
                <p class="preview-description">Primeras 10 filas de la base procesada - 'IDEFF_processed.csv'</p>
                <div class="table-container">
                    <table class="data-table" id="preview-table-procesados">
                        <thead>
                            <tr>
                                <th>Cargando...</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cargando datos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>


        <!-- Nacional Section -->
        <section class="content-section">
            <h2>Nacional</h2>
            <p class="section-description">An√°lisis de la evoluci√≥n delictiva a nivel nacional</p>
            
            <!-- Placeholder for your content -->
            <div class="placeholder-content">
                <p>Tu contenido aqu√≠...</p>
            </div>
        </section>

        <!-- Estatal Section -->
        <section class="content-section">
            <h2>Estatal</h2>
            <p class="section-description">An√°lisis estatal con evoluci√≥n de rankings</p>
            
            <!-- Placeholder for your content -->
            <div class="placeholder-content">
                <p>Tu contenido aqu√≠...</p>
            </div>
        </section>

        <!-- Snapshots Section -->
        <section class="content-section">
            <h2>Snapshots Temporales</h2>
            <p class="section-description">Vista r√°pida de la evoluci√≥n temporal</p>
            
            <!-- Placeholder for your content -->
            <div class="placeholder-content">
                <p>Tu contenido aqu√≠...</p>
            </div>
        </section>
    </main>

    <!-- JavaScript para cargar estad√≠sticas -->
         <!-- JavaScript para cargar estad√≠sticas -->
    <script>
        // Funci√≥n para cargar estad√≠sticas de la base ORIGINAL
        async function loadOriginalStats() {
            try {
                console.log('üîÑ Cargando estad√≠sticas de base original...');
                const response = await fetch('data/stats.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const stats = await response.json();
                console.log('‚úÖ Estad√≠sticas originales cargadas:', stats);
                
                // Actualizar elementos de la base ORIGINAL
                if (stats.total_registros !== undefined) {
                    document.getElementById('total-registros-original').textContent = stats.total_registros.toLocaleString();
                }
                
                if (stats.fecha_minima && stats.fecha_maxima) {
                    document.getElementById('periodo-original').textContent = `${stats.fecha_minima} - ${stats.fecha_maxima}`;
                }
                
                if (stats.conceptos_unicos !== undefined) {
                    document.getElementById('conceptos-unicos-original').textContent = stats.conceptos_unicos;
                }
                
                if (stats.estados_unicos !== undefined) {
                    document.getElementById('total-estados-original').textContent = stats.estados_unicos;
                } else {
                    document.getElementById('total-estados-original').textContent = '32';
                }
                
                console.log('‚úÖ Base original actualizada');
                
            } catch (error) {
                console.error('‚ùå Error cargando estad√≠sticas originales:', error);
                document.getElementById('total-registros-original').textContent = 'Error';
                document.getElementById('periodo-original').textContent = 'Error';
                document.getElementById('conceptos-unicos-original').textContent = 'Error';
                document.getElementById('total-estados-original').textContent = 'Error';
            }
        }
        
        // Funci√≥n para cargar estad√≠sticas de la base PROCESADA
        async function loadProcessedStats() {
            try {
                console.log('üîÑ Cargando estad√≠sticas de base procesada...');
                const response = await fetch('data/stats_processed.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const stats = await response.json();
                console.log('‚úÖ Estad√≠sticas procesadas cargadas:', stats);
                
                // Actualizar elementos de la base PROCESADA
                if (stats.total_registros_procesados !== undefined) {
                    document.getElementById('total-registros-procesados').textContent = stats.total_registros_procesados.toLocaleString();
                }
                
                if (stats.fecha_minima_procesada && stats.fecha_maxima_procesada) {
                    document.getElementById('periodo-procesado').textContent = `${stats.fecha_minima_procesada} - ${stats.fecha_maxima_procesada}`;
                }
                
                if (stats.conceptos_unicos_procesados !== undefined) {
                    document.getElementById('conceptos-unicos-procesados').textContent = stats.conceptos_unicos_procesados;
                }
                
                if (stats.estados_unicos_procesados !== undefined) {
                    document.getElementById('total-estados-procesados').textContent = stats.estados_unicos_procesados;
                }
                
                console.log('‚úÖ Base procesada actualizada');
                
            } catch (error) {
                console.error('‚ùå Error cargando estad√≠sticas procesadas:', error);
                document.getElementById('total-registros-procesados').textContent = 'Error';
                document.getElementById('periodo-procesado').textContent = 'Error';
                document.getElementById('conceptos-unicos-procesados').textContent = 'Error';
                document.getElementById('total-estados-procesados').textContent = 'Error';
            }
        }
        
        // Funci√≥n para cargar preview de la base PROCESADA (solo esta)
        async function loadProcessedPreview() {
            try {
                console.log('üîÑ Cargando preview de base procesada...');
                const response = await fetch('data/preview_processed.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const previewData = await response.json();
                updatePreviewTable('preview-table-procesados', previewData);
                console.log('‚úÖ Preview procesado actualizado');
                
            } catch (error) {
                console.error('‚ùå Error cargando preview procesado:', error);
                document.getElementById('preview-table-procesados').innerHTML = '<tbody><tr><td>Error cargando preview</td></tr></tbody>';
            }
        }
        
        // Funci√≥n auxiliar para actualizar tabla de preview
        function updatePreviewTable(tableId, previewData) {
            if (previewData.length > 0) {
                const columns = Object.keys(previewData[0]);
                
                let tableHTML = '<thead><tr>';
                columns.forEach(col => {
                    tableHTML += `<th>${col}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';
                
                previewData.forEach(row => {
                    tableHTML += '<tr>';
                    columns.forEach(col => {
                        const value = row[col] || '';
                        tableHTML += `<td>${value}</td>`;
                    });
                    tableHTML += '</tr>';
                });
                
                tableHTML += '</tbody>';
                document.getElementById(tableId).innerHTML = tableHTML;
            }
        }
        
        // Cargar todos los datos cuando la p√°gina se cargue
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina cargada, iniciando carga de datos...');
            loadOriginalStats();
            loadProcessedStats();
            loadProcessedPreview(); // Solo este preview
        });
        
        // Tambi√©n cargar cuando se haga clic en la secci√≥n (para debugging)
        document.querySelectorAll('.content-section').forEach(section => {
            section.addEventListener('click', function() {
                console.log('Section clicked:', this.querySelector('h2').textContent);
            });
        });
    </script>
</body>
</html>
